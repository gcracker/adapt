#!/usr/bin/env bash
IMAGE="node:8"

TOP_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )/.." && pwd )"
CTR_ADD_PATH="/src/node_modules/.bin"

DOCKER_ARGS+=" -eYARN_CACHE_FOLDER=/root/.cache/yarn -v${HOME}/.cache/yarn:/root/.cache/yarn"
DOCKER_ARGS+=" -v/var/run/docker.sock:/var/run/docker.sock"
DOCKER_ARGS+=" -v${HOME}/.adaptAwsCreds:/root/.adaptAwsCreds"

if [[ $(pwd) =~ ${TOP_DIR}/([^/]+) ]]; then
    PROJECT="${BASH_REMATCH[1]}"
    if [ -n "${PROJECT}" ]; then
        CTR_ADD_PATH="/src/${PROJECT}/node_modules/.bin:${CTR_ADD_PATH}"
    fi
fi

. "${TOP_DIR}/containit/containit.sh"
